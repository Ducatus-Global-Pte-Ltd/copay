<ion-header>
  <ion-navbar>
    <ion-title>{{ 'Confirm' | translate }}</ion-title>
    <ion-buttons right>
      <button (click)="openInBrowser()" ion-button>
        <ion-icon
          ><img src="assets/img/icon-link-external-light.svg"
        /></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>
</ion-header>

<ion-content>
  <ion-list class="settings-list">
    <ion-item>
      <div class="header-container">
        <div class="gift-card-title">{{ invoiceName }}</div>
        <div class="amount-label">
          <div class="amount">
            <div *ngIf="wallet">
              {{ coinAmount }}
              <span class="amount-coin">{{ wallet.coin | uppercase }}</span>
            </div>
            <div *ngIf="!wallet">
              {{ amount }} <span class="amount-coin">{{ currency }}</span>
            </div>
            <img
              class="sending-img"
              src="assets/img/icon-tx-sent-outline.svg"
            />
          </div>
          <div *ngIf="totalAmount" class="alternative">
            {{ totalAmount | formatCurrency: currency }} {{ currencyIsoCode }}
          </div>
        </div>
      </div>
    </ion-item>

    <ion-item-group class="info">
      <ion-item>
        <span translate>Payment Expires:</span>
        <ion-note *ngIf="!paymentExpired" item-end>{{
          remainingTimeStr
        }}</ion-note>
        <ion-note
          *ngIf="paymentExpired"
          [ngStyle]="{ color: 'red' }"
          item-end
          >{{ 'Expired' | translate }}</ion-note
        >
      </ion-item>

      <button ion-item detail-none (click)="showWallets()" class="wallets-list">
        <div>{{ 'Sending From' | translate }}</div>
        <div class="wallet">
          <ion-icon item-start>
            <img
              *ngIf="network == 'testnet'"
              [ngStyle]="{ 'background-color': wallet && wallet.color }"
              src="assets/img/icon-wallet-testnet.svg"
              class="icon-wallet"
            />
            <img
              *ngIf="network != 'testnet'"
              [ngStyle]="{ 'background-color': wallet && wallet.color }"
              src="assets/img/icon-wallet.svg"
              class="icon-wallet"
            />
          </ion-icon>
          <div>{{ wallet ? wallet.name : 'Select a wallet' }}</div>
          <div class="last-item" item-end>
            <button ion-button clear color="grey" icon-only>
              <ion-icon
                *ngIf="!isOpenSelector"
                name="ios-arrow-down-outline"
              ></ion-icon>
              <ion-icon
                *ngIf="isOpenSelector"
                name="ios-arrow-up-outline"
              ></ion-icon>
            </button>
          </div>
        </div>
      </button>

      <div>
        <ion-item-divider> {{ 'Refund Email' | translate }} </ion-item-divider>
        <ion-item>
          <ion-input
            placeholder="{{'Enter an email address' | translate}}"
            [(ngModel)]="email"
            name="email"
            type="email"
            [disabled]="
              !!(this.buyerProvidedEmail || this.merchantProvidedEmail)
            "
          ></ion-input>
        </ion-item>
      </div>

      <label-tip *ngIf="!isValidEmail()" type="danger">
        <span label-tip-title translate
          ><strong>A refund email is required.</strong></span
        >
        <div label-tip-body translate>
          If there is an issue with this payment, or a refund needs to be made,
          we will contact you at this address.<br />
          <a (click)="openPrivacyPolicy()" translate>View Privacy Policy</a>
        </div>
      </label-tip>

      <div *ngIf="totalAmountStr">
        <ion-item-divider style="margin-top: 5px">
          <div class="details-header">
            <div>{{ 'Details' | translate }}</div>
            <div class="last-item" item-end>
              <div class="switcher" (click)="changeUnit()" tappable item-end>
                <img class="switcher__icon" src="assets/img/icon-swap.svg" />
                <div class="switcher__label">{{ detailsCurrency }}</div>
              </div>
            </div>
          </div>
        </ion-item-divider>
        <ion-item>
          <span>{{ 'Invoice' | translate }}</span>
          <ion-note item-end>
            <div *ngIf="detailsCurrency === wallet.coin.toUpperCase()">
              <span *ngIf="onlyIntegers">{{ amount | number: '1.0-0' }}</span>
              <span *ngIf="!onlyIntegers">{{ amount | number: '1.2-2' }}</span>
              {{ currencyIsoCode }}
            </div>
            <span *ngIf="detailsCurrency === currency">{{
              subTotalAmountStr
            }}</span>
          </ion-note>
        </ion-item>
        <ion-item>
          <span>{{ 'Network cost' | translate }}</span>
          <ion-note item-end>
            <div *ngIf="detailsCurrency === wallet.coin.toUpperCase()">
              <span *ngIf="onlyIntegers">{{
                invoiceFee | number: '1.0-0'
              }}</span>
              <span *ngIf="!onlyIntegers">{{
                invoiceFee | number: '1.2-2'
              }}</span>
              {{ currencyIsoCode }}
            </div>
            <span *ngIf="detailsCurrency === currency">{{
              invoiceFeeSat | satToUnit: wallet.coin
            }}</span>
          </ion-note>
        </ion-item>
        <ion-item>
          <span>{{ 'Miner fee' | translate }}</span>
          <ion-note item-end>
            <div *ngIf="detailsCurrency === wallet.coin.toUpperCase()">
              <span *ngIf="onlyIntegers">{{
                networkFee | number: '1.0-0'
              }}</span>
              <span *ngIf="!onlyIntegers">{{
                networkFee | number: '1.2-2'
              }}</span>
              {{ currencyIsoCode }}
            </div>
            <span *ngIf="detailsCurrency === currency">{{
              networkFeeSat | satToUnit: wallet.coin
            }}</span>
          </ion-note>
        </ion-item>
        <ion-item>
          <span>{{ 'Total' | translate }}</span>
          <ion-note item-end>
            <div *ngIf="detailsCurrency === currency">
              <span *ngIf="totalAmount">
                <span *ngIf="onlyIntegers">{{
                  totalAmount | number: '1.0-0'
                }}</span>
                <span *ngIf="!onlyIntegers">{{
                  totalAmount | number: '1.2-2'
                }}</span>
                {{ currencyIsoCode }}
              </span>
            </div>
            <span *ngIf="detailsCurrency === wallet.coin.toUpperCase()">{{
              totalAmountStr
            }}</span>
          </ion-note>
        </ion-item>
      </div>
    </ion-item-group>
  </ion-list>
</ion-content>

<ion-footer>
  <page-slide-to-accept
    #slideButton
    *ngIf="isCordova"
    [disabled]="
      !(wallet && totalAmountStr && isValidEmail() && !paymentExpired)
    "
    buttonText="{{'Slide to confirm' | translate}}"
    (slideDone)="buyConfirm()"
    [ngClass]="{
      'slide-confirm-fast slide-confirm-down': hideSlideButton,
      'slide-confirm-slow': !hideSlideButton
    }"
  ></page-slide-to-accept>
  <ion-toolbar *ngIf="!isCordova">
    <button
      ion-button
      full
      class="button-footer"
      (click)="buyConfirm()"
      [disabled]="
        !(wallet && totalAmountStr && isValidEmail() && !paymentExpired)
      "
    >
      {{ 'Confirm
      purchase' | translate }}
    </button>
  </ion-toolbar>
</ion-footer>
